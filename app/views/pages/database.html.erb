<h1 class="display-4 text-center mt-5">Database Overview</h1>

<div class="container mt-4">
  <p class="lead text-muted text-center">
    Here you can find an overview of all available property listings in the system.
  </p>

  <h1 class="text-center mb-4">All Properties</h1>

  <div class="price-slider">
  <label for="price-range">Price Range: </label>
  <input type="range" id="price-range" min="0" max="4000000" step="1000" value="1000000">
  <span id="price-display">0 - 5000000</span>
</div>

<table class="table table-striped table-bordered">
  <thead>
  <tr>
    <th><%= sortable_column("ID", "id") %></th>
    <th><%= sortable_column("Name", "name") %></th>
    <th><%= sortable_column("Rooms", "rooms") %></th>
    <th><%= sortable_column("Size", "size") %></th>
    <th><%= sortable_column("Price", "price") %></th>
  </tr>
</thead>

  <tbody id="wohnungen-list">
  <% @wohnungs.each do |wohnung| %>
    <tr class="wohnung" data-price="<%= wohnung.price.to_f %>">
      <td><%= wohnung.id %></td>
      <td><%= wohnung.name %></td>
      <td><%= wohnung.rooms %></td>
      <td><%= wohnung.size %> mÂ²</td>
      <td><%= number_to_currency(wohnung.price) %></td>
    </tr>
  <% end %>
</tbody>
</table>

  <div class="text-center mt-4">
    <%= link_to "View All Properties", wohnungs_path, class: "btn btn-outline-dark mb-4" %>
  </div>
</div>
<script>
function setupSlider() {
  const priceSlider = document.getElementById('price-range');
  const priceDisplay = document.getElementById('price-display');
  const wohnungenList = document.getElementById('wohnungen-list');

  if (!priceSlider || !wohnungenList) return;

  const wohnungRows = wohnungenList.getElementsByClassName('wohnung');

  // Set initial display
  priceDisplay.textContent = `0 - ${priceSlider.value}`;

  // Remove any existing listeners to avoid duplicates
  const newSlider = priceSlider.cloneNode(true);
  priceSlider.parentNode.replaceChild(newSlider, priceSlider);

  newSlider.addEventListener('input', function () {
    const maxPrice = parseFloat(newSlider.value);
    priceDisplay.textContent = `0 - ${maxPrice.toLocaleString()}`;

    Array.from(wohnungRows).forEach(function (row) {
      const rowPrice = parseFloat(row.getAttribute('data-price'));
      if (rowPrice <= maxPrice) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
  });
}

document.addEventListener('DOMContentLoaded', setupSlider);
document.addEventListener('turbo:load', setupSlider);
</script>
